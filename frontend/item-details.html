<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Details - SmartStyle AI</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--mist-gray);
            align-items: center;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            font-weight: 600;
            color: var(--mountain-blue);
            min-width: 120px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .detail-value {
            color: var(--slate-gray);
            text-align: right;
            font-size: 1.05rem;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
        }
        .badge-large {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 500;
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/dashboard.html" class="navbar-brand">SmartStyle AI</a>
            <ul class="navbar-links">
                <li><a href="/dashboard.html">Dashboard</a></li>
                <li><a href="/wardrobe.html">Wardrobe</a></li>
                <li><a href="/analytics.html">Analytics</a></li>
                <li><a href="#" id="logout-btn">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div style="margin-bottom: 2rem;">
            <button class="btn btn-outline" onclick="window.history.back()" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                ‚Üê Back to Wardrobe
            </button>
        </div>

        <div id="item-details-container">
            <div style="text-align: center; padding: 3rem;">
                <div class="spinner" style="width: 50px; height: 50px; margin: 0 auto;"></div>
                <p style="margin-top: 1rem; color: var(--slate-gray);">Loading item details...</p>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script>
        // Get item ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get('id');

        if (!itemId) {
            SmartStyle.showAlert('Item not found', 'error');
            setTimeout(() => {
                window.location.href = '/wardrobe.html';
            }, 2000);
        } else {
            loadItemDetails(itemId);
        }

        async function loadItemDetails(itemId) {
            try {
                const item = await SmartStyle.apiRequest(`/api/wardrobe/item/${itemId}`);
                displayItemDetails(item);
            } catch (error) {
                console.error('Load error:', error);
                document.getElementById('item-details-container').innerHTML = `
                    <div class="card" style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üòï</div>
                        <h3>Failed to load item details</h3>
                        <p style="color: var(--slate-gray); margin: 1rem 0;">${error.message || 'Unknown error'}</p>
                        <button class="btn btn-primary" onclick="window.location.href='/wardrobe.html'">
                            Back to Wardrobe
                        </button>
                    </div>
                `;
            }
        }

        function displayItemDetails(item) {
            const container = document.getElementById('item-details-container');
            
            container.innerHTML = `
                <div class="card">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h1 style="margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                ${item.name}
                                ${item.is_favorite ? '<span style="color: gold; font-size: 2rem;">‚≠ê</span>' : ''}
                            </h1>
                            <p style="margin: 0; color: var(--slate-gray); font-size: 1.1rem;">
                                ${item.category} ‚Ä¢ ${item.style} ‚Ä¢ ${item.season}
                            </p>
                        </div>
                    </div>

                    <!-- Main Grid: Image Left, Details Right -->
                    <div class="grid grid-2" style="gap: 2rem; align-items: start;">
                        
                        <!-- LEFT SIDE: Image -->
                        <div>
                            <div style="position: sticky; top: 2rem;">
                                <div style="border-radius: 20px; overflow: hidden; box-shadow: 0 8px 32px rgba(44, 95, 124, 0.15); background: #f5f5f5;">
                                    ${item.image_path ? 
                                        `<img src="${item.image_path}" alt="${item.name}" style="width: 100%; height: auto; max-height: 600px; object-fit: cover; display: block;">` : 
                                        `<div style="width: 100%; height: 500px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #E8F4F8 0%, #C1E7F4 100%);">
                                            <div style="font-size: 8rem; margin-bottom: 1rem;">üëï</div>
                                            <p style="color: var(--slate-gray); font-size: 1.1rem;">No image available</p>
                                        </div>`
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT SIDE: All Details -->
                        <div>
                            
                            <!-- Basic Information -->
                            <div class="card" style="background: linear-gradient(135deg, #E8F4F8 0%, #F8F9FA 100%); margin-bottom: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: var(--mountain-blue); display: flex; align-items: center; gap: 0.5rem;">
                                    üìã Item Information
                                </h3>
                                
                                <div class="detail-row">
                                    <span class="detail-label">üëï Type</span>
                                    <span class="detail-value">${item.type || 'Not specified'}</span>
                                </div>
                                
                                <div class="detail-row">
                                    <span class="detail-label">üìÇ Category</span>
                                    <span class="detail-value">${item.category}</span>
                                </div>
                                
                                <div class="detail-row">
                                    <span class="detail-label">üé® Color</span>
                                    <span class="detail-value">
                                        <span class="badge-large" style="background: #FFE5E5; color: #C13838;">${item.color}</span>
                                    </span>
                                </div>
                                
                                <div class="detail-row">
                                    <span class="detail-label">‚ú® Pattern</span>
                                    <span class="detail-value">${item.pattern}</span>
                                </div>
                                
                                <div class="detail-row">
                                    <span class="detail-label">üí´ Style</span>
                                    <span class="detail-value">
                                        <span class="badge-large" style="background: #E5F5FF; color: #2C5F7C;">${item.style}</span>
                                    </span>
                                </div>
                                
                                <div class="detail-row">
                                    <span class="detail-label">üå°Ô∏è Season</span>
                                    <span class="detail-value">
                                        <span class="badge-large" style="background: #E5FFE8; color: #2D5A4A;">${item.season}</span>
                                    </span>
                                </div>
                                
                                ${item.brand ? `
                                    <div class="detail-row">
                                        <span class="detail-label">üè∑Ô∏è Brand</span>
                                        <span class="detail-value">${item.brand}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Usage Statistics -->
                            <div class="card" style="background: linear-gradient(135deg, #FFF4E5 0%, #FFFAF0 100%); margin-bottom: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: var(--mountain-blue); display: flex; align-items: center; gap: 0.5rem;">
                                    üìä Usage Statistics
                                </h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="text-align: center; padding: 1.5rem; background: rgba(255,255,255,0.7); border-radius: 12px;">
                                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üëî</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--mountain-blue); margin-bottom: 0.25rem;">${item.wear_count}</div>
                                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Times Worn</div>
                                    </div>
                                    
                                    <div style="text-align: center; padding: 1.5rem; background: rgba(255,255,255,0.7); border-radius: 12px;">
                                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìÖ</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--mountain-blue); margin-bottom: 0.25rem;">${item.days_since_worn}</div>
                                        <div style="font-size: 0.9rem; color: var(--slate-gray);">Days Since Worn</div>
                                    </div>
                                </div>
                                
                                ${item.last_worn ? `
                                    <div class="detail-row">
                                        <span class="detail-label">üïê Last Worn</span>
                                        <span class="detail-value">${new Date(item.last_worn).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                                    </div>
                                ` : `
                                    <div style="text-align: center; padding: 1rem; color: var(--slate-gray);">
                                        Never worn yet
                                    </div>
                                `}
                                
                                ${item.cost && item.wear_count > 0 ? `
                                    <div class="detail-row">
                                        <span class="detail-label">üí∞ Cost Per Wear</span>
                                        <span class="detail-value" style="font-size: 1.2rem; font-weight: 600;">$${item.cost_per_wear}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Tags -->
                            <div class="card" style="background: linear-gradient(135deg, #F0E8FF 0%, #F8F5FF 100%); margin-bottom: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: var(--mountain-blue); display: flex; align-items: center; gap: 0.5rem;">
                                    üè∑Ô∏è Tags
                                </h3>
                                
                                <div style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
                                    ${item.tags && item.tags.length > 0 ? 
                                        item.tags.map(tag => `
                                            <span class="badge-large" style="background: rgba(var(--color-teal-500-rgb), 0.15); color: var(--color-teal-700); border: 1px solid rgba(var(--color-teal-500-rgb), 0.3);">
                                                üè∑Ô∏è ${tag}
                                            </span>
                                        `).join('') : 
                                        '<p style="color: var(--slate-gray); margin: 0;">No tags added yet</p>'
                                    }
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="logWear(${item.id})" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    üëî Log Wear Today
                                </button>
                                
                                <button class="btn btn-${item.is_favorite ? 'secondary' : 'outline'}" onclick="toggleFavorite(${item.id})" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    ${item.is_favorite ? '‚≠ê Favorited' : '‚òÜ Add to Favorites'}
                                </button>
                                
                                <button class="btn btn-secondary" onclick="window.location.href='/wardrobe.html'" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    ‚úèÔ∏è Edit Item
                                </button>
                                
                                <button class="btn btn-outline" onclick="deleteItem(${item.id})" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; border: 2px solid #ff4444; color: #ff4444;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>

                            ${item.days_since_worn > 60 ? `
                                <div class="alert alert-info" style="margin-top: 2rem; background: linear-gradient(135deg, #FFF4E5 0%, #FFE5CC 100%); border-left: 4px solid #C17000;">
                                    <strong>üí° AI Recommendation:</strong> You haven't worn this in ${item.days_since_worn} days! 
                                    Consider adding it to your next outfit rotation or donating if you no longer wear it.
                                </div>
                            ` : ''}

                        </div>
                    </div>
                </div>
            `;
        }

        // Log wear
        async function logWear(itemId) {
            try {
                const data = await SmartStyle.apiRequest(`/api/wardrobe/item/${itemId}/wear`, {
                    method: 'PUT'
                });
                
                SmartStyle.showAlert(`‚úÖ Wear logged! Total wears: ${data.wear_count}`, 'success');
                
                setTimeout(() => {
                    location.reload();
                }, 1500);
                
            } catch (error) {
                SmartStyle.showAlert('Failed to log wear', 'error');
            }
        }

        // Toggle favorite
        async function toggleFavorite(itemId) {
            try {
                const data = await SmartStyle.apiRequest(`/api/wardrobe/item/${itemId}/favorite`, {
                    method: 'PUT'
                });
                
                SmartStyle.showAlert(
                    data.is_favorite ? '‚≠ê Added to favorites!' : '‚òÜ Removed from favorites',
                    'success'
                );
                
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
            } catch (error) {
                SmartStyle.showAlert('Failed to update favorite', 'error');
            }
        }

        // Delete item
        async function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
                return;
            }
            
            SmartStyle.showLoading();
            
            try {
                await SmartStyle.apiRequest(`/api/wardrobe/item/${itemId}`, {
                    method: 'DELETE'
                });
                
                SmartStyle.showAlert('‚úÖ Item deleted successfully!', 'success');
                
                setTimeout(() => {
                    window.location.href = '/wardrobe.html';
                }, 1500);
                
            } catch (error) {
                SmartStyle.showAlert('Failed to delete item', 'error');
            } finally {
                SmartStyle.hideLoading();
            }
        }
    </script>
</body>
</html>
